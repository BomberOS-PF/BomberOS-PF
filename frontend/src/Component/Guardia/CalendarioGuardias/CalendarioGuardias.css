/* ================================
  TARJETA MINI (flotante)
================================ */
.cal-mini-card {
  position: fixed;
  right: 16px;
  bottom: 16px;
  width: clamp(360px, 28vw, 560px);
  z-index: 1049;
  --guard-fill: rgba(240,128,128,.35);
  --guard-border: #b30000;
  --guard-fill-strong: rgba(213,43,30,.5);
}

/* Wrapper del calendario dentro de la card */
.calendar-mini-wrapper {
  min-height: 360px;
}

/* Forzamos a FullCalendar a usar el alto del contenedor cal-compact */
.cal-compact {
  --cal-h: min(50vh, 520px); /* ↓ más bajo que antes */
  position: relative;
}
.cal-compact .fc,
.cal-compact .fc .fc-view-harness,
.cal-compact .fc .fc-scroller-harness,
.cal-compact .fc .fc-scroller {
  height: var(--cal-h) !important;
}

/* ================================
  AJUSTES DE FULLCALENDAR
================================ */
.cal-mini-card .fc a.fc-daygrid-day-number,
.cal-mini-card .fc .fc-daygrid-day-number,
.cal-mini-card .fc-daygrid-day-number {
  color: #111 !important;
  text-decoration: none !important;
}
/* Quitar fondo default de "hoy" para no tapar overlays */
.cal-mini-card .fc .fc-daygrid-day.fc-day-today .fc-daygrid-day-frame {
  background: transparent !important;
}

/* Toolbar más compacta */
.cal-compact .fc .fc-toolbar { gap: .25rem }
.cal-compact .fc .fc-toolbar-title { font-size: 1rem }
.cal-compact .fc .fc-button { padding: .25rem .4rem; font-size: .875rem }

/* Estructura interna usada para overlays y bandas */
.fc .fc-daygrid-day-frame { position: relative }

/* ================================
  OVERLAYS / BADGE HOY
================================ */
.fc-guard-overlay {
  position: absolute;
  inset: 2px;
  background: var(--guard-fill, rgba(240,128,128,.35));
  border: 1px solid var(--guard-border, #b30000);
  border-radius: 6px;
  pointer-events: none;
  display: flex;
  align-items: center;
  justify-content: center;
}
.cal-mini-card td.fc-daygrid-day .fc-guard-overlay.is-today {
  background: var(--guard-fill-strong, rgba(213,43,30,.55));
  border-color: var(--guard-border, #b30000);
}

/* Badge “¡Hoy Guardia!” centrado dentro del casillero */
.cal-mini-card td.fc-daygrid-day .fc-guard-overlay .hoy-guardia-badge {
  position: static;
  pointer-events: none;
  font-weight: 700;
  font-size: 12px;
  color: #b30000;
  background: rgba(255,255,255,.9);
  border: 1px solid rgba(179,0,0,.35);
  border-radius: 6px;
  padding: 2px 6px;
  box-shadow: 0 1px 3px rgba(0,0,0,.15);
  margin: 0 auto;
}

/* ================================
  TOOLTIP FLOTANTE
================================ */
.tooltip-dinamico {
  position: fixed;
  display: none;
  pointer-events: none;
  white-space: pre;
  padding: 6px 8px;
  background: #222;
  color: #fff;
  border-radius: 6px;
  font-size: 12px;
  box-shadow: 0 2px 8px rgba(0,0,0,.25);
  z-index: 3000;
}

/* ================================
  BOTONERA DE MODO (Mis/Grupos)
================================ */
.calendar-mode-switch .btn {
  line-height: 1.1;
  padding: .25rem .5rem;
}
@media (max-width: 576px) {
  .calendar-mode-switch {
    gap: .25rem;
    flex-wrap: nowrap;
  }
  .calendar-mode-switch .btn {
    padding: .25rem .4rem;
    font-size: .875rem;
  }
  .calendar-mode-switch .btn .me-1 { margin-right: 0 }
}

/* ================================
  VERSION EN PÁGINA (no flotante)
================================ */
.cal-page-card {
  position: static;
  right: auto;
  bottom: auto;
  width: 100%;
  max-width: 100%;
  z-index: auto;
}
.cal-page-card .card-header {
  position: relative;
  z-index: 2;
  overflow: visible;
}
.cal-page-card .card-header .btn-group {
  display: flex;
  gap: .5rem;
}
.cal-page-card .card-header .btn.btn-outline-light {
  border-color: rgba(255,255,255,.6);
  color: #fff;
}

/* ================================
  BANDAS POR GRUPO (si las usás)
================================ */
.band-grupo {
  width: 100%;
  display: flex;
  align-items: center;
  gap: 4px;
}
.band-grupo .band-label {
  pointer-events: none;
  background: rgba(255,255,255,.45);
  border-radius: 4px;
}

/* ================================
  RESPONSIVE
================================ */
@media (max-width: 576px) {
  /* Menor alto mínimo en mobile */
  .calendar-mini-wrapper { min-height: 260px }

  /* Calendario más bajo en mobile */
  .cal-compact { --cal-h: 44vh }

  /* Toolbar apilable y más espaciada */
  .fc .fc-toolbar.fc-header-toolbar {
    flex-wrap: wrap;
    row-gap: 6px;
    margin: 0 0 6px;
    padding: 0;
  }
  .fc .fc-toolbar-title {
    font-size: 1rem;
    line-height: 1.1;
  }
  .fc .fc-toolbar-chunk {
    display: flex;
    align-items: center;
    gap: 8px;
  }
  .fc .fc-button-group {
    display: flex;
    gap: 6px;
  }
  .fc .fc-button-group .fc-button + .fc-button { margin-left: 6px }
  .fc .fc-button {
    margin: 0 !important;
    padding: 4px 8px;
    font-size: .8rem;
    min-width: 36px;
    line-height: 1.2;
  }

  /* Celdas más eficientes en vertical */
  .fc .fc-daygrid-day-frame { padding: 2px }
  .fc .fc-daygrid-day-number { padding: 2px; font-size: .85rem }
}

/* Pantallas angostas y muy altas (ej. 412x915+) */
/* Si querés aún MÁS bajo, podés bajar este valor también */
@media (max-width: 430px) and (min-height: 800px) {
  .cal-compact { --cal-h: 46vh }
}

/* Safe areas (notch) */
@supports (height: env(safe-area-inset-top)) {
  @media (max-width: 430px) {
    .cal-compact .fc,
    .cal-compact .fc .fc-view-harness,
    .cal-compact .fc .fc-scroller-harness,
    .cal-compact .fc .fc-scroller {
      height: calc(44vh - env(safe-area-inset-top) - env(safe-area-inset-bottom)) !important;
    }
  }
}

/* ===== Collapsible (mostrar solo encabezado) ===== */
.cal-collapsible { overflow: visible }
.cal-collapsible .card-header { cursor: default }

/* Altura normal del body (auto) con transición suave */
.cal-collapsible .cal-body {
  overflow: hidden;
  transition: height .25s ease, padding .25s ease, opacity .2s ease;
}

/* Cuando está colapsado: solo header visible */
.cal-collapsible.is-collapsed .cal-body {
  height: 0 !important;
  padding-top: 0 !important;
  padding-bottom: 0 !important;
  opacity: 0;
}

/* Para que la transición calcule la altura automáticamente */
.cal-collapsible:not(.is-collapsed) .cal-body {
  height: auto;
}

/* Ocultar leyendas/footers cuando está colapsado */
.cal-collapsible.is-collapsed .cal-body > *:not(.keep-visible) {
  /* ya se ocultan por height:0 y overflow:hidden */
}

/* Botón de max/min más compacto */
.toggle-cal-btn { line-height: 1; padding: .25rem .5rem }

/* ===== Z-index para quedar por encima del menú hamburguesa ===== */
/* Bootstrap: offcanvas=1045, backdrop=1040 → subimos el calendario */
.cal-mini-card { z-index: 1060 }

/* Si en tu app el offcanvas quedó por encima, “bajalo” un poco */
.offcanvas { z-index: 1045 !important }
.offcanvas-backdrop { z-index: 1040 !important }
.cal-mini-card { z-index: 1030 !important; }
body.offcanvas-open .tooltip-dinamico { z-index: 1031 !important; }

/* ===== Centrado duro en mobile, aplicado al wrapper real del JSX ===== */
@media (max-width: 576px){
  .calendar-mobile-center{
    display: grid;
    justify-items: center;          /* centra horizontalmente hijos */
    width: 100%;
  }

  /* El hijo directo (tu calendario) toma un ancho simétrico */
  .calendar-mobile-center > *{
    width: min(100%, 392px);        /* 412px viewport → ~10px margen a ambos lados */
    margin: 0 auto;
  }

  /* La raíz de FullCalendar ocupa todo el ancho del bloque centrado */
  .calendar-mobile-center .fc{
    width: 100% !important;
    max-width: 100% !important;
    margin: 0 auto !important;
  }

  /* Neutralizamos “empujes” internos que desalinean */
  .calendar-mobile-center .fc .fc-scrollgrid,
  .calendar-mobile-center .fc .fc-scrollgrid-sync-table,
  .calendar-mobile-center .fc .fc-view-harness,
  .calendar-mobile-center .fc .fc-scroller-harness,
  .calendar-mobile-center .fc .fc-scroller,
  .calendar-mobile-center .fc .fc-timegrid,
  .calendar-mobile-center .fc .fc-daygrid{
    min-width: 0 !important;
    width: 100% !important;
    max-width: 100% !important;
  }

  /* Quitar bordes laterales que “simulan” margen desigual */
  .calendar-mobile-center .fc .fc-scrollgrid{
    border-left-width: 0 !important;
    border-right-width: 0 !important;
  }

  /* Tabla sin expansión rara */
  .calendar-mobile-center .fc table{
    table-layout: fixed !important;
    width: 100% !important;
    margin: 0 auto !important;
  }

  /* Header centrado */
  .calendar-mobile-center .fc .fc-header-toolbar{
    display: flex !important;
    flex-wrap: wrap !important;
    justify-content: center !important;
    gap: 6px !important;
    text-align: center !important;
  }
  .calendar-mobile-center .fc .fc-toolbar-chunk{
    display: flex !important;
    justify-content: center !important;
    width: 100% !important;
  }
  .calendar-mobile-center .fc .fc-toolbar-title{
    width: 100% !important;
    text-align: center !important;
    font-size: 1rem !important;
  }
}

/* Por las dudas, sin scroll horizontal global */
html, body { overflow-x: hidden; }

/* ===== Centro exacto en mobile (412×915 incl.) ===== */
@media (max-width: 576px){
  /* El contenedor toma todo el ancho y se centra visualmente */
  .fc-mobile-wrap{
    width: 100%;
    max-width: 392px;          /* 412 - 2*10px de margen visual */
    margin-inline: auto;       /* centrado perfecto */
    padding-inline: 10px;      /* márgenes simétricos */
    box-sizing: border-box;
  }

  /* FullCalendar ocupa el 100% del bloque centrado */
  .fc-mobile-wrap .fc{
    width: 100% !important;
    max-width: 100% !important;
    margin: 0 auto !important;
  }

  /* Neutraliza empujes internos de FullCalendar que rompen el centrado */
  .fc-mobile-wrap .fc .fc-scrollgrid,
  .fc-mobile-wrap .fc .fc-scrollgrid-sync-table,
  .fc-mobile-wrap .fc .fc-view-harness,
  .fc-mobile-wrap .fc .fc-scroller-harness,
  .fc-mobile-wrap .fc .fc-scroller,
  .fc-mobile-wrap .fc .fc-timegrid,
  .fc-mobile-wrap .fc .fc-daygrid{
    min-width: 0 !important;
    width: 100% !important;
    max-width: 100% !important;
    overflow: hidden;
  }

  /* Quita “margen falso” por bordes laterales */
  .fc-mobile-wrap .fc .fc-scrollgrid{
    border-left-width: 0 !important;
    border-right-width: 0 !important;
  }

  /* Tabla sin expansión rara */
  .fc-mobile-wrap .fc table{
    table-layout: fixed !important;
    width: 100% !important;
    margin-inline: auto !important;
  }

  /* Header centrado */
  .fc-mobile-wrap .fc .fc-header-toolbar{
    display: flex !important;
    flex-wrap: wrap !important;
    justify-content: center !important;
    gap: 6px !important;
    text-align: center !important;
  }
  .fc-mobile-wrap .fc .fc-toolbar-chunk{
    display: flex !important;
    justify-content: center !important;
    width: 100% !important;
  }
  .fc-mobile-wrap .fc .fc-toolbar-title{
    width: 100% !important;
    text-align: center !important;
    font-size: 1rem !important;
  }
}

/* Seguridad global contra desborde lateral */
html, body{ overflow-x: hidden; }
